(()=>{"use strict";const e=(e,t)=>{fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((t=>{e(t)})).catch((()=>{t("ОШИБКА ЗАГРУЗКИ ДАННЫХ")}))},t="any",r=document.querySelector(".map__filters"),o=r.querySelectorAll("select, fieldset"),n=r.querySelector("#housing-type"),a=r.querySelector("#housing-price"),s=r.querySelector("#housing-rooms"),l=r.querySelector("#housing-guests"),c=r.querySelector("#housing-features");r.classList.add("map__filters--disabled"),o.forEach((e=>{e.disabled=!0}));const d=e=>"Escape"===e.key,i=(e,t)=>{let r;return function(){const o=()=>{e.apply(this,arguments)};clearTimeout(r),r=setTimeout(o,t)}},u=(e,t,r=[2,0,1,1,1,2])=>t[e%100>4&&e%100<20?2:r[e%10<5?e%10:5]],p=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),y=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),m=y.querySelector(".error__button"),v=(e,t)=>{document.addEventListener(e,t)},h=(e,t)=>{document.removeEventListener(e,t)},f=()=>{document.body.appendChild(y);const e=t=>{d(t)&&(t.preventDefault(),y.remove(),document.removeEventListener("keydown",e))};v("keydown",e),m.addEventListener("click",(()=>{y.remove(),h("keydown",e)})),y.addEventListener("click",(()=>{y.remove(),h("keydown",e)}))},g=["gif","jpg","jpeg","png","webp","svg","avif","ico","tiff"],S=document.querySelector(".ad-form"),q=S.querySelector("#avatar"),_=S.querySelector(".ad-form-header__preview"),L=S.querySelector(".ad-form-header__preview img"),b=S.querySelector("#images"),E=S.querySelector(".ad-form__photo");q.addEventListener("change",(()=>{const e=q.files[0],t=e.name.toLowerCase();if(g.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{L.src=t.result,L.width="70",L.height="70",L.style.borderRadius="5px",_.style.padding="0"})),t.readAsDataURL(e)}})),b.addEventListener("change",(()=>{const e=b.files[0],t=e.name.toLowerCase();if(g.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("img");E.appendChild(e),e.src=t.result,e.alt="Фотография жилья",e.width="70",e.height="70",e.style.borderRadius="5px"})),t.readAsDataURL(e)}}));const w={1:[1],2:[1,2],3:[1,2,3],100:[0]},C={bungalow:0,flat:1e3,hotel:3e3,house:5e3,palace:1e4},k=document.querySelector(".ad-form"),x=k.querySelectorAll(".ad-form fieldset"),$=k.querySelector("#type"),V=k.querySelector("#price"),T=k.querySelector("#timein"),A=k.querySelector("#timeout"),D=k.querySelector("#address"),R=k.querySelector("#title"),j=k.querySelector("#room_number"),z=k.querySelector("#capacity"),F=k.querySelector(".ad-form__reset"),M=k.querySelectorAll("input"),H=k.querySelectorAll("select");k.classList.add("ad-form--disabled"),x.forEach((e=>{e.disabled=!0})),$.addEventListener("change",(()=>{V.min=C[$.value],V.placeholder=C[$.value]})),T.addEventListener("change",(()=>{A.value=T.value})),A.addEventListener("change",(()=>{T.value=A.value}));const N=e=>{D.value=`${e.lat.toFixed(5)}, ${e.lng.toFixed(5)}`};R.addEventListener("input",(()=>{const e=R.value.length;e<30?(R.style.borderColor="red",R.setCustomValidity(`Слишком короткий заголовок! Пожалуйста, добавьте ещё ${30-e} символов(-а)`)):e>100?(R.style.borderColor="red",R.setCustomValidity(`Слишком длинный заголовок! Пожалуйста, удалите лишние ${e-100} символов(-а)`)):(R.style.borderColor="",R.setCustomValidity("")),R.reportValidity()})),V.addEventListener("input",(()=>{V.value<C[$.value]?(V.style.borderColor="red",V.setCustomValidity(`Минимальная цена за ночь - ${C[$.value]} руб.`)):V.value>1e6?(V.style.borderColor="red",V.setCustomValidity("Максимальная цена за ночь - 1 000 000 руб.")):(V.style.borderColor="",V.setCustomValidity("")),V.reportValidity()}));const U=()=>{w[+j.value].includes(+z.value)?(z.style.borderColor="",z.setCustomValidity("")):(z.style.borderColor="red",z.setCustomValidity("Недопустимое количество гостей!")),z.reportValidity()};j.addEventListener("change",U),z.addEventListener("change",U);const I=()=>{r.reset(),k.reset(),M.forEach((e=>e.style.borderColor="")),H.forEach((e=>e.style.borderColor="")),re(),V.min=C[$.value],V.placeholder=C[$.value],te(),e((e=>ee(e))),L.src="img/muffin-grey.svg",L.width="40",L.height="44",_.style.padding="0 15px",E.innerHTML=""};F.addEventListener("click",(e=>{e.preventDefault(),I()})),k.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=()=>{(()=>{document.body.appendChild(p);const e=t=>{d(t)&&(t.preventDefault(),p.remove(),document.removeEventListener("keydown",e))};v("keydown",e),p.addEventListener("click",(()=>{p.remove(),h("keydown",e)}))})(),I()},r=f,o=new FormData(e.target),fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{e.ok?t():r("Не удалось отправить форму. Попробуйте ещё раз!")})).catch((()=>{r("Не удалось отправить форму. Попробуйте ещё раз!")}))}));const O={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало",hotel:"Отель"},P=[" комната для "," комнаты для "," комнат для "],W=[" гостя"," гостей"," гостей"],G=document.querySelector("#card").content.querySelector(".popup"),B=window.L,J={lat:35.675,lng:139.75},K=B.icon({iconUrl:"./img/pins/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),Q=B.icon({iconUrl:"./img/pins/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),X=B.map("map-canvas"),Y=B.marker(J,{draggable:!0,icon:K});Y.addTo(X),Y.on("move",(e=>{const t=e.target.getLatLng();N(t)}));const Z=B.layerGroup().addTo(X),ee=e=>{e.slice(0,10).forEach((e=>{(e=>{B.marker({lat:e.location.lat,lng:e.location.lng},{icon:Q}).addTo(Z).bindPopup((({author:e,offer:t})=>{const r=G.cloneNode(!0);r.querySelector(".popup__avatar").src=e.avatar,r.querySelector(".popup__title").textContent=t.title,r.querySelector(".popup__text--address").textContent=t.address,r.querySelector(".popup__text--price").innerHTML=`${t.price} <span>₽/ночь</span>`,r.querySelector(".popup__type").textContent=O[t.type],r.querySelector(".popup__text--capacity").textContent=`${t.rooms} ${u(t.rooms,P)} ${t.guests} ${u(t.guests,W)}`,r.querySelector(".popup__text--time").textContent=`Заезд после ${t.checkin}, выезд до ${t.checkout}`;const o=r.querySelector(".popup__features");o.innerHTML="",t.features?t.features.forEach((e=>{const t=document.createElement("li");t.classList.add("popup__feature",`popup__feature--${e}`),o.appendChild(t)})):o.remove();const n=r.querySelector(".popup__description");t.description?n.textContent=t.description:n.remove();const a=r.querySelector(".popup__photos"),s=a.querySelector(".popup__photo");return a.innerHTML="",t.photos?t.photos.forEach((e=>{const t=s.cloneNode(!0);t.src=e,a.appendChild(t)})):a.remove(),r})(e),{keepInView:!0})})(e)}))},te=()=>Z.clearLayers(),re=()=>{X.setView(J,13),Y.setLatLng(J),N(J)};var oe;oe=()=>{k.classList.remove("ad-form--disabled"),x.forEach((e=>{e.disabled=!1})),e((e=>{var d;ee(e),d=i((()=>{te(),ee(e.filter((e=>(e=>n.value===e.offer.type||n.value===t)(e)&&(e=>{switch(a.value){case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<=5e4;case"high":return e.offer.price>5e4;default:return a.value===t}})(e)&&(e=>e.offer.rooms===+s.value||s.value===t)(e)&&(e=>e.offer.guests===+l.value||l.value===t)(e)&&((e=[])=>{const t=[...c.querySelectorAll(".map__checkbox")].filter((e=>e.checked));return!t.length||t.every((t=>e.includes(t.value)))})(e.offer.features))))}),500),r.addEventListener("change",(()=>{d()})),r.classList.remove("map__filters--disabled"),o.forEach((e=>{e.disabled=!1}))}),(e=>(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="20px 10px",t.style.fontSize="30px",t.style.textAlign="center",t.style.color="white",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})(e)))},X.on("load",(()=>{N(J),oe()})).setView(J,13),B.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(X)})();
//# sourceMappingURL=main.bundle.js.map