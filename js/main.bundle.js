(()=>{"use strict";const e=(e,t)=>{fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((t=>{e(t)})).catch((()=>{t("ОШИБКА ЗАГРУЗКИ ДАННЫХ")}))},t=e=>"Escape"===e.key,r=(e,t)=>{let r;return function(){const o=()=>{e.apply(this,arguments)};clearTimeout(r),r=setTimeout(o,t)}},o=(e,t,r=[2,0,1,1,1,2])=>t[e%100>4&&e%100<20?2:r[e%10<5?e%10:5]],n=(e,t)=>{e.forEach((e=>{e.disabled=t}))},a="any",s=document.querySelector(".map__filters"),l=s.querySelectorAll("select, fieldset"),c=s.querySelector("#housing-type"),i=s.querySelector("#housing-price"),d=s.querySelector("#housing-rooms"),u=s.querySelector("#housing-guests"),p=s.querySelector("#housing-features");s.classList.add("map__filters--disabled"),n(l,!0);const y=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),m=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),v=m.querySelector(".error__button"),h=(e,t)=>{document.addEventListener(e,t)},f=(e,t)=>{document.removeEventListener(e,t)},g=()=>{document.body.appendChild(m);const e=r=>{t(r)&&(r.preventDefault(),m.remove(),document.removeEventListener("keydown",e))};h("keydown",e),v.addEventListener("click",(()=>{m.remove(),f("keydown",e)})),m.addEventListener("click",(()=>{m.remove(),f("keydown",e)}))},S=["gif","jpg","jpeg","png","webp","svg","avif","ico","tiff"],q=document.querySelector(".ad-form"),_=q.querySelector("#avatar"),L=q.querySelector(".ad-form-header__preview"),b=q.querySelector(".ad-form-header__preview img"),w=q.querySelector("#images"),C=q.querySelector(".ad-form__photo");_.addEventListener("change",(()=>{const e=_.files[0],t=e.name.toLowerCase();if(S.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{b.src=t.result,b.width="70",b.height="70",b.style.borderRadius="5px",L.style.padding="0"})),t.readAsDataURL(e)}})),w.addEventListener("change",(()=>{const e=w.files[0],t=e.name.toLowerCase();if(S.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("img");C.appendChild(e),e.src=t.result,e.alt="Фотография жилья",e.width="70",e.height="70",e.style.borderRadius="5px"})),t.readAsDataURL(e)}}));const E={1:[1],2:[1,2],3:[1,2,3],100:[0]},k={bungalow:0,flat:1e3,hotel:3e3,house:5e3,palace:1e4},x=document.querySelector(".ad-form"),$=x.querySelectorAll(".ad-form fieldset"),V=x.querySelector("#type"),T=x.querySelector("#price"),A=x.querySelector("#timein"),D=x.querySelector("#timeout"),R=x.querySelector("#address"),j=x.querySelector("#title"),z=x.querySelector("#room_number"),F=x.querySelector("#capacity"),M=x.querySelector(".ad-form__reset"),H=x.querySelectorAll("input"),N=x.querySelectorAll("select");x.classList.add("ad-form--disabled"),n($,!0),V.addEventListener("change",(()=>{T.min=k[V.value],T.placeholder=k[V.value]})),A.addEventListener("change",(()=>{D.value=A.value})),D.addEventListener("change",(()=>{A.value=D.value}));const U=e=>{R.value=`${e.lat.toFixed(5)}, ${e.lng.toFixed(5)}`};j.addEventListener("input",(()=>{const e=j.value.length;e<30?(j.style.borderColor="red",j.setCustomValidity(`Слишком короткий заголовок! Пожалуйста, добавьте ещё ${30-e} символов(-а)`)):e>100?(j.style.borderColor="red",j.setCustomValidity(`Слишком длинный заголовок! Пожалуйста, удалите лишние ${e-100} символов(-а)`)):(j.style.borderColor="",j.setCustomValidity("")),j.reportValidity()})),T.addEventListener("input",(()=>{T.value<k[V.value]?(T.style.borderColor="red",T.setCustomValidity(`Минимальная цена за ночь - ${k[V.value]} руб.`)):T.value>1e6?(T.style.borderColor="red",T.setCustomValidity("Максимальная цена за ночь - 1 000 000 руб.")):(T.style.borderColor="",T.setCustomValidity("")),T.reportValidity()}));const I=()=>{E[+z.value].includes(+F.value)?(F.style.borderColor="",F.setCustomValidity("")):(F.style.borderColor="red",F.setCustomValidity("Недопустимое количество гостей!")),F.reportValidity()};z.addEventListener("change",I),F.addEventListener("change",I);const O=()=>{s.reset(),x.reset(),H.forEach((e=>e.style.borderColor="")),N.forEach((e=>e.style.borderColor="")),oe(),T.min=k[V.value],T.placeholder=k[V.value],re(),e((e=>te(e))),b.src="img/muffin-grey.svg",b.width="40",b.height="44",L.style.padding="0 15px",C.innerHTML=""};M.addEventListener("click",(e=>{e.preventDefault(),O()})),x.addEventListener("submit",(e=>{var r,o,n;e.preventDefault(),r=()=>{(()=>{document.body.appendChild(y);const e=r=>{t(r)&&(r.preventDefault(),y.remove(),document.removeEventListener("keydown",e))};h("keydown",e),y.addEventListener("click",(()=>{y.remove(),f("keydown",e)}))})(),O()},o=g,n=new FormData(e.target),fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:n}).then((e=>{e.ok?r():o("Не удалось отправить форму. Попробуйте ещё раз!")})).catch((()=>{o("Не удалось отправить форму. Попробуйте ещё раз!")}))}));const P={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало",hotel:"Отель"},W=[" комната для "," комнаты для "," комнат для "],G=[" гостя"," гостей"," гостей"],B=document.querySelector("#card").content.querySelector(".popup"),J=window.L,K={lat:35.675,lng:139.75},Q=J.icon({iconUrl:"./img/pins/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),X=J.icon({iconUrl:"./img/pins/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),Y=J.map("map-canvas"),Z=J.marker(K,{draggable:!0,icon:Q});Z.addTo(Y),Z.on("move",(e=>{const t=e.target.getLatLng();U(t)}));const ee=J.layerGroup().addTo(Y),te=e=>{e.slice(0,10).forEach((e=>{(e=>{J.marker({lat:e.location.lat,lng:e.location.lng},{icon:X}).addTo(ee).bindPopup((({author:e,offer:t})=>{const r=B.cloneNode(!0);r.querySelector(".popup__avatar").src=e.avatar,r.querySelector(".popup__title").textContent=t.title,r.querySelector(".popup__text--address").textContent=t.address,r.querySelector(".popup__text--price").innerHTML=`${t.price} <span>₽/ночь</span>`,r.querySelector(".popup__type").textContent=P[t.type],r.querySelector(".popup__text--capacity").textContent=`${t.rooms} ${o(t.rooms,W)} ${t.guests} ${o(t.guests,G)}`,r.querySelector(".popup__text--time").textContent=`Заезд после ${t.checkin}, выезд до ${t.checkout}`;const n=r.querySelector(".popup__features");n.innerHTML="",t.features?t.features.forEach((e=>{const t=document.createElement("li");t.classList.add("popup__feature",`popup__feature--${e}`),n.appendChild(t)})):n.remove();const a=r.querySelector(".popup__description");t.description?a.textContent=t.description:a.remove();const s=r.querySelector(".popup__photos"),l=s.querySelector(".popup__photo");return s.innerHTML="",t.photos?t.photos.forEach((e=>{const t=l.cloneNode(!0);t.src=e,s.appendChild(t)})):s.remove(),r})(e),{keepInView:!0})})(e)}))},re=()=>ee.clearLayers(),oe=()=>{Y.setView(K,13),Z.setLatLng(K),U(K)};var ne;ne=()=>{x.classList.remove("ad-form--disabled"),n($,!1),e((e=>{var t;te(e),t=r((()=>{re(),te(e.filter((e=>(e=>c.value===e.offer.type||c.value===a)(e)&&(e=>{switch(i.value){case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<=5e4;case"high":return e.offer.price>5e4;default:return i.value===a}})(e)&&(e=>e.offer.rooms===+d.value||d.value===a)(e)&&(e=>e.offer.guests===+u.value||u.value===a)(e)&&((e=[])=>{const t=[...p.querySelectorAll(".map__checkbox")].filter((e=>e.checked));return!t.length||t.every((t=>e.includes(t.value)))})(e.offer.features))))}),500),s.addEventListener("change",(()=>{t()})),s.classList.remove("map__filters--disabled"),n(l,!1)}),(e=>(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="20px 10px",t.style.fontSize="30px",t.style.textAlign="center",t.style.color="white",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})(e)))},Y.on("load",(()=>{U(K),ne()})).setView(K,13),J.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(Y)})();
//# sourceMappingURL=main.bundle.js.map