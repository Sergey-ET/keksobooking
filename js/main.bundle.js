(()=>{"use strict";const e=(e,t)=>{fetch("https://23.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((t=>{e(t)})).catch((()=>{t("ОШИБКА ЗАГРУЗКИ ДАННЫХ")}))},t="any",r=document.querySelector(".map__filters"),o=r.querySelectorAll(".map__filters select"),n=r.querySelectorAll(".map__filters fieldset"),s=r.querySelector("#housing-type"),a=r.querySelector("#housing-price"),l=r.querySelector("#housing-rooms"),d=r.querySelector("#housing-guests"),i=r.querySelector("#housing-features");(()=>{r.classList.add("map__filters--disabled");for(let e=0;e<o.length;e++)o[e].setAttribute("disabled","disabled");for(let e=0;e<n.length;e++)n[e].setAttribute("disabled","disabled")})();const c=e=>"Escape"===e.key,u=(e,t)=>{let r;return function(){const o=()=>{e.apply(this,arguments)};clearTimeout(r),r=setTimeout(o,t)}},p=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),m=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),y=m.querySelector(".error__button"),v=()=>{document.body.appendChild(m);const e=t=>{c(t)&&(t.preventDefault(),m.remove(),document.removeEventListener("keydown",e))};document.addEventListener("keydown",e),y.addEventListener("click",(()=>{m.remove(),document.removeEventListener("keydown",e)})),m.addEventListener("click",(()=>{m.remove(),document.removeEventListener("keydown",e)}))},h=["gif","jpg","jpeg","png","webp","svg","avif","ico","tiff"],f=document.querySelector(".ad-form"),g=f.querySelector("#avatar"),b=f.querySelector(".ad-form-header__preview"),S=f.querySelector(".ad-form-header__preview img"),_=f.querySelector("#images"),q=f.querySelector(".ad-form__photo");g.addEventListener("change",(()=>{const e=g.files[0],t=e.name.toLowerCase();if(h.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{S.src=t.result,S.width="70",S.height="70",S.style.borderRadius="5px",b.style.padding="0"})),t.readAsDataURL(e)}})),_.addEventListener("change",(()=>{const e=_.files[0],t=e.name.toLowerCase();if(h.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("img");q.appendChild(e),e.src=t.result,e.alt="Фотография жилья",e.width="70",e.height="70",e.style.borderRadius="5px"})),t.readAsDataURL(e)}}));const L={palace:1e4,flat:1e3,house:5e3,bungalow:0,hotel:3e3},C=document.querySelector(".ad-form"),w=C.querySelectorAll(".ad-form fieldset"),E=C.querySelector("#type"),k=C.querySelector("#price"),x=C.querySelector("#timein"),A=C.querySelector("#timeout"),V=C.querySelector("#address"),T=C.querySelector("#title"),D=C.querySelector("#room_number"),F=C.querySelector("#capacity"),M=C.querySelector(".ad-form__reset"),R=C.querySelectorAll("input"),j=C.querySelectorAll("select");(()=>{C.classList.add("ad-form--disabled");for(let e=0;e<w.length;e++)w[e].setAttribute("disabled","disabled")})(),E.addEventListener("change",(()=>{k.min=L[E.value],k.placeholder=L[E.value]})),x.addEventListener("change",(()=>{A.value=x.value})),A.addEventListener("change",(()=>{x.value=A.value}));const z=e=>{V.value=e.lat.toFixed(5)+", "+e.lng.toFixed(5)};T.addEventListener("input",(()=>{const e=T.value.length;e<30?(T.style.borderColor="red",T.setCustomValidity("Слишком короткий заголовок! Пожалуйста, добавьте ещё "+(30-e)+" символов(-а)")):e>100?(T.style.borderColor="red",T.setCustomValidity("Слишком длинный заголовок! Пожалуйста, удалите лишние "+(e-100)+" символов(-а)")):(T.style.borderColor="",T.setCustomValidity("")),T.reportValidity()})),k.addEventListener("input",(()=>{k.value<L[E.value]?(k.style.borderColor="red",k.setCustomValidity("Минимальная цена за ночь - "+L[E.value]+" руб.")):k.value>1e6?(k.style.borderColor="red",k.setCustomValidity("Максимальная цена за ночь - 1 000 000 руб.")):(k.style.borderColor="",k.setCustomValidity("")),k.reportValidity()}));const U=()=>{"1"===D.value&&"1"!==F.value?(F.style.borderColor="red",F.setCustomValidity("Одна комната только для одного гостя!")):"2"===D.value&&"1"!==F.value&&"2"!==F.value?(F.style.borderColor="red",F.setCustomValidity("Две комнаты только для одного или двух гостей!")):"3"===D.value&&"0"===F.value?(F.style.borderColor="red",F.setCustomValidity("Три комнаты для одного, двух или трех гостей!")):"100"===D.value&&"0"!==F.value?(F.style.borderColor="red",F.setCustomValidity("Сто комнат не для гостей!")):(F.style.borderColor="",F.setCustomValidity("")),F.reportValidity()};D.addEventListener("change",U),F.addEventListener("change",U);const H=()=>{r.reset(),C.reset(),R.forEach((e=>e.style.borderColor="")),j.forEach((e=>e.style.borderColor="")),Z(),k.min=L[E.value],k.placeholder=L[E.value],Y(),e((e=>X(e))),S.src="img/muffin-grey.svg",S.width="40",S.height="44",b.style.padding="0 15px",q.innerHTML=""};M.addEventListener("click",(e=>{e.preventDefault(),H()})),C.addEventListener("submit",(e=>{var t,r,o;e.preventDefault(),t=()=>{(()=>{document.body.appendChild(p);const e=t=>{c(t)&&(t.preventDefault(),p.remove(),document.removeEventListener("keydown",e))};document.addEventListener("keydown",e),p.addEventListener("click",(()=>{p.remove(),document.removeEventListener("keydown",e)}))})(),H()},r=v,o=new FormData(e.target),fetch("https://23.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{e.ok?t():r("Не удалось отправить форму. Попробуйте ещё раз!")})).catch((()=>{r("Не удалось отправить форму. Попробуйте ещё раз!")}))}));const N={palace:"Дворец",flat:"Квартира",house:"Дом",bungalow:"Бунгало",hotel:"Отель"},$=["комната","комнаты","комнат"],I=["гостя","гостей"],O=document.querySelector("#card").content.querySelector(".popup"),P=window.L,W={lat:35.675,lng:139.75},B=P.icon({iconUrl:"./img/pins/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),G=P.icon({iconUrl:"./img/pins/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),J=P.map("map-canvas"),K=P.marker(W,{draggable:!0,icon:B});K.addTo(J),K.on("move",(e=>{const t=e.target.getLatLng();z(t)}));const Q=[],X=e=>{e.slice(0,10).forEach((e=>{(e=>{const t=P.marker({lat:e.location.lat,lng:e.location.lng},{icon:G});t.addTo(J).bindPopup((({author:e,offer:t})=>{const r=O.cloneNode(!0);r.querySelector(".popup__avatar").src=e.avatar,r.querySelector(".popup__title").textContent=t.title,r.querySelector(".popup__text--address").textContent=t.address,r.querySelector(".popup__text--price").textContent=t.price+" ₽/ночь",r.querySelector(".popup__type").textContent=N[t.type],r.querySelector(".popup__text--capacity").textContent=t.rooms+" "+((e,t)=>{let r=(e=Math.abs(e)%100)%10;return e>10&&e<20?t[2]:r>1&&r<5?t[1]:1===r?t[0]:t[2]})(t.rooms,$)+" для "+t.guests+" "+((e,t)=>{let r=(e=Math.abs(e)%100)%20;return r>1&&r<20?t[1]:1===r?t[0]:t[1]})(t.guests,I),r.querySelector(".popup__text--time").textContent="Заезд после "+t.checkin+", выезд до "+t.checkout,r.querySelector(".popup__description").textContent=t.description;const o=r.querySelector(".popup__features");if(o.innerHTML="",t.features){const e=(e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${e}`),t.appendChild(r)})),t})(t.features);o.appendChild(e)}else o.remove();const n=r.querySelector(".popup__photos");if(n.innerHTML="",t.photos){const e=(e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const r=document.createElement("img");r.src=e,r.classList.add("popup__photo"),r.alt="Фотография жилья",r.setAttribute("width","45"),r.setAttribute("height","40"),t.appendChild(r)})),t})(t.photos);n.appendChild(e)}else n.remove();return r})(e),{keepInView:!0}),Q.push(t)})(e)}))},Y=()=>{Q.forEach((e=>e.remove()))},Z=()=>{J.setView(W,13),K.setLatLng(W),z(W)};var ee;ee=()=>{(()=>{C.classList.remove("ad-form--disabled");for(let e=0;e<w.length;e++)w[e].removeAttribute("disabled")})(),e((e=>{var c;X(e),c=u((()=>{Y(),X(e.filter((e=>(e=>s.value===e.offer.type||s.value===t)(e)&&(e=>{switch(a.value){case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<=5e4;case"high":return e.offer.price>5e4;default:return a.value===t}})(e)&&(e=>{switch(l.value){case"1":return 1===e.offer.rooms;case"2":return 2===e.offer.rooms;case"3":return 3===e.offer.rooms;default:return l.value===t}})(e)&&(e=>{switch(d.value){case"1":return 1===e.offer.guests;case"2":return 2===e.offer.guests;case"0":return 0===e.offer.guests;default:return d.value===t}})(e)&&((e=[])=>{const t=[...i.querySelectorAll(".map__checkbox")].filter((e=>e.checked)).map((e=>e.value));return!t.length||t.every((t=>e.includes(t)))})(e.offer.features))))}),500),r.addEventListener("change",(()=>{c()})),(()=>{r.classList.remove("map__filters--disabled");for(let e=0;e<o.length;e++)o[e].removeAttribute("disabled");for(let e=0;e<n.length;e++)n[e].removeAttribute("disabled")})()}),(e=>(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="20px 10px",t.style.fontSize="30px",t.style.textAlign="center",t.style.color="white",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})(e)))},J.on("load",(()=>{z(W),ee()})).setView(W,13),P.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(J)})();
//# sourceMappingURL=main.bundle.js.map